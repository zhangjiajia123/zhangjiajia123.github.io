<!DOCTYPE html>
<meta
  name="viewport"
  content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
/>
<!-- three.js 3Dæ¸²æŸ“åº“ -->
<script src="../../vendor/three.js/build/three.js"></script>
<script src="../../vendor/three.js/examples/js/libs/stats.min.js"></script>
<!-- ARToolKit å¢å¼ºç°å®åº“ -->
<script src="../../../vendor/jsartoolkit5/build/artoolkit.min.js"></script>
<script src="../../../vendor/jsartoolkit5/js/artoolkit.api.js"></script>
<!-- å¼•å…¥ threex.artoolkit æ‰©å±• -->
<script src="../../../src/threex/threex-artoolkitsource.js"></script>
<script src="../../../src/threex/threex-artoolkitcontext.js"></script>
<script src="../../../src/threex/threex-artoolkitprofile.js"></script>
<script src="../../../src/threex/threex-arbasecontrols.js"></script>
<script src="../../../src/threex/threex-armarkercontrols.js"></script>
<script src="../../../src/threex/threex-arsmoothedcontrols.js"></script>
<script>
  THREEx.ArToolkitContext.baseURL = "../../../";
</script>

<!-- å¼•å…¥å›¾æ¡ˆæ–‡ä»¶å¤„ç† -->
<script src="../threex-arpatternfile.js"></script>
<!-- éƒ¨ç½²æµ‹è¯•ç¯å¢ƒæ—¶æ”¾å¼€ vconsole ç”¨äºæµ‹è¯•  -->
<script src="https://cdn.banyou.70180.cn/assets/xcontent/vconsole/vconsole.min.js"></script>
<script>
  let vConsole = new window.VConsole();
</script>

<body
  style="
    margin: 0px;
    overflow: hidden;
    font-family: Monospace;
    background: black;
  "
>
  <!-- ä½¿ç”¨æç¤º -->
  <div
    id="info"
    style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      z-index: 100;
      font-size: 18px;
      border: 2px solid #4fc3f7;
      box-shadow: 0 0 20px rgba(79, 195, 247, 0.5);
    "
  >
    <div style="font-size: 24px; margin-bottom: 15px; color: #4fc3f7">
      ğŸ” ARå¢å¼ºç°å®æ¼”ç¤º
    </div>
    è¯·å°†æ‘„åƒå¤´å¯¹å‡†ARæ ‡è®°å›¾æ¡ˆ<br />
    <small style="color: #b0bec5">æ¨¡å‹å°†åœ¨è¯†åˆ«åˆ°æ ‡è®°åæ˜¾ç¤º</small>
  </div>

  <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <div
    id="status"
    style="
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      z-index: 100;
      font-size: 14px;
      display: none;
    "
  >
    âœ… æ ‡è®°å·²è¯†åˆ«
  </div>

  <!-- ç‚¹å‡»æç¤º -->
  <div
    id="clickHint"
    style="
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: #4fc3f7;
      padding: 10px 15px;
      border-radius: 20px;
      z-index: 100;
      font-size: 14px;
      display: none;
    "
  >
    ğŸ’¡ ç‚¹å‡»ç²‰è‰²çƒä½“æœ‰æƒŠå–œï¼
  </div>

  <!-- ç‚¹å‡»æ•ˆæœæ˜¾ç¤º -->
  <div
    id="clickEffect"
    style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #ffeb3b;
      font-size: 48px;
      z-index: 100;
      display: none;
      text-shadow: 0 0 20px rgba(255, 235, 59, 0.8);
      pointer-events: none;
    "
  >
    âœ¨
  </div>

  <!-- è°ƒè¯•ä¿¡æ¯ -->
  <div
    id="debugInfo"
    style="
      position: absolute;
      top: 100px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #00ff00;
      padding: 10px;
      border-radius: 5px;
      z-index: 100;
      font-size: 12px;
      display: none;
      max-width: 300px;
    "
  >
    è°ƒè¯•ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
  </div>

  <script>
    //////////////////////////////////////////////////////////////////////////////////
    //		åˆå§‹åŒ–
    //////////////////////////////////////////////////////////////////////////////////

    // åˆå§‹åŒ–WebGLæ¸²æŸ“å™¨
    var renderer = new THREE.WebGLRenderer({
      alpha: true, // å¯ç”¨é€æ˜èƒŒæ™¯
      antialias: true, // å¯ç”¨æŠ—é”¯é½¿
      preserveDrawingBuffer: true, // ä¿ç•™ç»˜å›¾ç¼“å†²åŒº
    });

    // è®¾ç½®æ¸²æŸ“å™¨ä¸ºå…¨å±
    renderer.setClearColor(new THREE.Color("black"), 0); // é»‘è‰²èƒŒæ™¯
    renderer.setPixelRatio(window.devicePixelRatio || 1); // æ”¯æŒé«˜DPIå±å¹•
    renderer.setSize(window.innerWidth, window.innerHeight); // å…¨å±å°ºå¯¸

    // è®¾ç½®æ¸²æŸ“å™¨DOMå…ƒç´ æ ·å¼ä¸ºå…¨å±è¦†ç›–
    renderer.domElement.style.position = "fixed";
    renderer.domElement.style.top = "0px";
    renderer.domElement.style.left = "0px";
    renderer.domElement.style.width = "100%";
    renderer.domElement.style.height = "100%";
    renderer.domElement.style.zIndex = "1";

    // å°†æ¸²æŸ“å™¨æ·»åŠ åˆ°é¡µé¢
    document.body.appendChild(renderer.domElement);

    // æ¸²æŸ“å¾ªç¯å‡½æ•°æ•°ç»„
    var onRenderFcts = [];

    // åˆå§‹åŒ–3Dåœºæ™¯
    var scene = new THREE.Scene();

    // æ·»åŠ ç¯å¢ƒå…‰
    var ambient = new THREE.AmbientLight(0x666666);
    scene.add(ambient);

    // æ·»åŠ å®šå‘å…‰
    var directionalLight = new THREE.DirectionalLight(0x887766);
    directionalLight.position.set(-1, 1, 1).normalize();
    scene.add(directionalLight);

    //////////////////////////////////////////////////////////////////////////////////
    //		åˆå§‹åŒ–åŸºç¡€ç›¸æœº
    //////////////////////////////////////////////////////////////////////////////////

    // åˆ›å»ºThree.jsç›¸æœºï¼ˆæŠ•å½±çŸ©é˜µå°†ç”±ARToolKitè®¾ç½®ï¼‰
    var camera = new THREE.Camera();
    scene.add(camera);

    // å°„çº¿æŠ•å°„å™¨ï¼ˆç”¨äº3Dç‰©ä½“ç‚¹å‡»æ£€æµ‹ï¼‰
    var raycaster = new THREE.Raycaster();
    var mouse = new THREE.Vector2();

    // å­˜å‚¨å¯ç‚¹å‡»çš„ç‰©ä½“
    var clickableObjects = [];

    // è°ƒè¯•å‡½æ•°
    function debugLog(message) {
      console.log(message);
      var debugElement = document.getElementById('debugInfo');
      if (debugElement) {
        debugElement.innerHTML = message;
        debugElement.style.display = 'block';
      }
    }

    ////////////////////////////////////////////////////////////////////////////////
    //         å¤„ç†ARè§†é¢‘æº
    ////////////////////////////////////////////////////////////////////////////////

    // åˆ›å»ºARè§†é¢‘æºï¼ˆä½¿ç”¨æ‘„åƒå¤´ï¼‰
    var arToolkitSource = new THREEx.ArToolkitSource({
      sourceType: "webcam", // ä½¿ç”¨æ‘„åƒå¤´ä½œä¸ºè§†é¢‘æº
    });

    // åˆå§‹åŒ–è§†é¢‘æº
    arToolkitSource.init(function onReady() {
      console.log("æ‘„åƒå¤´åˆå§‹åŒ–å®Œæˆ");

      // è®¾ç½®è§†é¢‘å…ƒç´ ä¸ºå…¨å±
      if (arToolkitSource.domElement) {
        arToolkitSource.domElement.style.position = "fixed";
        arToolkitSource.domElement.style.top = "0px";
        arToolkitSource.domElement.style.left = "0px";
        arToolkitSource.domElement.style.width = "100%";
        arToolkitSource.domElement.style.height = "100%";
        arToolkitSource.domElement.style.objectFit = "cover"; // ä¿æŒæ¯”ä¾‹å¹¶è¦†ç›–æ•´ä¸ªåŒºåŸŸ
        arToolkitSource.domElement.style.zIndex = "0";
      }

      // å¤„ç†æ¸²æŸ“å™¨å’ŒARç”»å¸ƒçš„å¤§å°è°ƒæ•´
      arToolkitSource.onResizeElement(
        [
          renderer.domElement,
          arToolkitContext.arController
            ? arToolkitContext.arController.canvas
            : null,
        ].filter(Boolean)
      );
    });

    // å¤„ç†çª—å£å¤§å°å˜åŒ–
    window.addEventListener("resize", function () {
      // æ›´æ–°æ¸²æŸ“å™¨å¤§å°ä¸ºå…¨å±
      renderer.setSize(window.innerWidth, window.innerHeight);

      // å¤„ç†ARè§†é¢‘æºå¤§å°è°ƒæ•´
      arToolkitSource.onResizeElement(
        [
          renderer.domElement,
          arToolkitContext.arController
            ? arToolkitContext.arController.canvas
            : null,
        ].filter(Boolean)
      );
    });

    ////////////////////////////////////////////////////////////////////////////////
    //         åˆå§‹åŒ–ARä¸Šä¸‹æ–‡
    ////////////////////////////////////////////////////////////////////////////////

    // åˆ›å»ºARå·¥å…·åŒ…ä¸Šä¸‹æ–‡
    var arToolkitContext = new THREEx.ArToolkitContext({
      cameraParametersUrl: "../../../data/data/camera_para.dat", // ç›¸æœºå‚æ•°æ–‡ä»¶
      detectionMode: "mono", // å•ç›®æ£€æµ‹æ¨¡å¼
      maxDetectionRate: 60, // æœ€å¤§æ£€æµ‹ç‡
      canvasWidth: 1280, // å¢åŠ ç”»å¸ƒå®½åº¦ä»¥æé«˜æ£€æµ‹ç²¾åº¦
      canvasHeight: 720, // å¢åŠ ç”»å¸ƒé«˜åº¦
      debug: false, // å…³é—­è°ƒè¯•æ¨¡å¼
    });

    // åˆå§‹åŒ–ARä¸Šä¸‹æ–‡
    arToolkitContext.init(function onCompleted() {
      console.log("ARä¸Šä¸‹æ–‡åˆå§‹åŒ–å®Œæˆ");
      // å°†ARæŠ•å½±çŸ©é˜µå¤åˆ¶åˆ°Three.jsç›¸æœº
      camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
    });

    // æ¯å¸§æ›´æ–°ARå·¥å…·åŒ…
    onRenderFcts.push(function () {
      if (arToolkitSource.ready === false) return;
      arToolkitContext.update(arToolkitSource.domElement);
    });

    ////////////////////////////////////////////////////////////////////////////////
    //         åˆ›å»ºARæ ‡è®°æ§åˆ¶å™¨
    ////////////////////////////////////////////////////////////////////////////////

    // åˆ›å»ºæ ‡è®°æ ¹ç»„ï¼ˆç”¨äºæ”¾ç½®è¯†åˆ«åˆ°çš„æ ‡è®°ï¼‰
    var markerRoot = new THREE.Group();
    markerRoot.visible = false; // åˆå§‹éšè—
    scene.add(markerRoot);

    // åˆ›å»ºARæ ‡è®°æ§åˆ¶å™¨
    var markerControls = new THREEx.ArMarkerControls(
      arToolkitContext,
      markerRoot,
      {
        type: "pattern", // å›¾æ¡ˆç±»å‹æ ‡è®°
        patternUrl: "/AR.js-master-three/data/data/marker.patt", // å›¾æ¡ˆæ–‡ä»¶URL
        size: 1.0, // æ ‡è®°ç‰©ç†å°ºå¯¸ï¼ˆç±³ï¼‰
        smooth: true, // å¯ç”¨å¹³æ»‘
        smoothCount: 5, // å¹³æ»‘å¸§æ•°
        smoothTolerance: 0.01, // å¹³æ»‘å®¹å·®
        smoothThreshold: 2, // å¹³æ»‘é˜ˆå€¼
      }
    );

    // æ·»åŠ æ ‡è®°æ‰¾åˆ°äº‹ä»¶ç›‘å¬
    markerControls.addEventListener("markerFound", function () {
      console.log("âœ… æ ‡è®°è¯†åˆ«æˆåŠŸ");
      document.getElementById("info").style.display = "none";
      document.getElementById("status").style.display = "block";
      document.getElementById("clickHint").style.display = "block";
      markerRoot.visible = true;
      debugLog("æ ‡è®°è¯†åˆ«æˆåŠŸï¼å¯ä»¥ç‚¹å‡»çƒä½“äº†");
    });

    // æ·»åŠ æ ‡è®°ä¸¢å¤±äº‹ä»¶ç›‘å¬
    markerControls.addEventListener("markerLost", function () {
      console.log("âŒ æ ‡è®°ä¸¢å¤±");
      document.getElementById("status").style.display = "none";
      document.getElementById("info").style.display = "block";
      document.getElementById("clickHint").style.display = "none";
      markerRoot.visible = false;
      debugLog("æ ‡è®°ä¸¢å¤±");
    });

    ////////////////////////////////////////////////////////////////////////////////
    //         åˆ›å»ºå¹³æ»‘æ§åˆ¶å™¨
    ////////////////////////////////////////////////////////////////////////////////

    // åˆ›å»ºå¹³æ»‘æ ¹ç»„ï¼ˆç”¨äºæ”¾ç½®3Dæ¨¡å‹ï¼‰
    var smoothedRoot = new THREE.Group();
    smoothedRoot.visible = false; // åˆå§‹éšè—
    scene.add(smoothedRoot);

    // åˆ›å»ºå¹³æ»‘æ§åˆ¶å™¨ï¼ˆå‡å°‘ARè·Ÿè¸ªæŠ–åŠ¨ï¼‰
    var smoothedControls = new THREEx.ArSmoothedControls(smoothedRoot, {
      minVisibleDelay: 0.3, // æœ€å°å¯è§å»¶è¿Ÿï¼ˆç§’ï¼‰
      minUnvisibleDelay: 0.5, // æœ€å°ä¸å¯è§å»¶è¿Ÿï¼ˆç§’ï¼‰
      smoothDelay: 0.1, // å¹³æ»‘å»¶è¿Ÿ
      smoothPosition: 0.8, // ä½ç½®å¹³æ»‘åº¦
      smoothRotation: 0.8, // æ—‹è½¬å¹³æ»‘åº¦
    });

    // å¹³æ»‘æ§åˆ¶å™¨å˜ä¸ºå¯è§äº‹ä»¶
    smoothedControls.addEventListener("becameVisible", function () {
      console.log("ğŸ‘ï¸ æ¨¡å‹å˜ä¸ºå¯è§");
      smoothedRoot.visible = true;
      debugLog("3Dæ¨¡å‹å·²æ˜¾ç¤º");
    });

    // å¹³æ»‘æ§åˆ¶å™¨å˜ä¸ºä¸å¯è§äº‹ä»¶
    smoothedControls.addEventListener("becameUnVisible", function () {
      console.log("ğŸ™ˆ æ¨¡å‹å˜ä¸ºä¸å¯è§");
      smoothedRoot.visible = false;
      debugLog("3Dæ¨¡å‹å·²éšè—");
    });

    // æ¯å¸§æ›´æ–°å¹³æ»‘æ§åˆ¶å™¨
    onRenderFcts.push(function (delta) {
      smoothedControls.update(markerRoot);
    });

    //////////////////////////////////////////////////////////////////////////////////
    //		åœ¨åœºæ™¯ä¸­æ·»åŠ 3Dç‰©ä½“
    //////////////////////////////////////////////////////////////////////////////////

    // æ·»åŠ ç¯é¢çº½ç»“ï¼ˆä¸»è¦3Dæ¨¡å‹ï¼‰
    var torusGeometry = new THREE.TorusKnotGeometry(0.3, 0.1, 128, 32);
    var torusMaterial = new THREE.MeshPhongMaterial({
      color: 0xff9800,
      shininess: 100,
      specular: 0x222222,
    });
    var torus = new THREE.Mesh(torusGeometry, torusMaterial);
    torus.position.y = 0.8;
    smoothedRoot.add(torus);

    // æ·»åŠ å¯ç‚¹å‡»çš„æµ®åŠ¨çƒä½“
    var sphereGeometry = new THREE.SphereGeometry(0.2, 32, 32); // ç¨å¾®å¢å¤§çƒä½“ä¾¿äºç‚¹å‡»
    var sphereMaterial = new THREE.MeshPhongMaterial({
      color: 0xe91e63,
      shininess: 100,
      emissive: 0xe91e63,
      emissiveIntensity: 0.3,
    });
    var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
    sphere.position.set(0.5, 0.5, 0.3);
    
    // ä¸ºçƒä½“æ·»åŠ è‡ªå®šä¹‰å±æ€§ï¼Œæ ‡è¯†ä¸ºå¯ç‚¹å‡»
    sphere.userData = { 
      clickable: true, 
      originalColor: 0xe91e63,
      originalScale: 1,
      name: "clickableSphere"
    };
    
    smoothedRoot.add(sphere);
    clickableObjects.push(sphere); // æ·»åŠ åˆ°å¯ç‚¹å‡»ç‰©ä½“æ•°ç»„
    console.log("å¯ç‚¹å‡»çƒä½“å·²åˆ›å»º:", sphere);

    // æ·»åŠ å¹³å°ä½œä¸ºçƒä½“çš„åº•åº§
    var platformGeometry = new THREE.CylinderGeometry(0.25, 0.25, 0.05, 16);
    var platformMaterial = new THREE.MeshPhongMaterial({
      color: 0x4fc3f7,
      transparent: true,
      opacity: 0.8,
    });
    var platform = new THREE.Mesh(platformGeometry, platformMaterial);
    platform.position.set(0.5, 0.3, 0.3);
    smoothedRoot.add(platform);

    // çƒä½“ç‚¹å‡»çŠ¶æ€å˜é‡
    var sphereClicked = false;
    var clickAnimationTime = 0;

    // æ·»åŠ åŠ¨ç”»æ•ˆæœ
    var animationTime = 0;
    onRenderFcts.push(function (delta) {
      animationTime += delta;

      // ç¯é¢çº½ç»“æ—‹è½¬
      torus.rotation.x = animationTime * 0.5;
      torus.rotation.y = animationTime * 0.8;

      // çƒä½“æµ®åŠ¨åŠ¨ç”»ï¼ˆå¦‚æœæœªè¢«ç‚¹å‡»ï¼‰
      if (!sphereClicked) {
        sphere.position.y = 0.5 + Math.sin(animationTime * 2) * 0.1;
      } else {
        // ç‚¹å‡»åçš„ç‰¹æ®ŠåŠ¨ç”»
        clickAnimationTime += delta;
        sphere.rotation.x = clickAnimationTime * 3;
        sphere.rotation.y = clickAnimationTime * 2;
        sphere.scale.setScalar(1 + Math.sin(clickAnimationTime * 5) * 0.2);
      }

      sphere.rotation.z = animationTime * 0.5;
    });

    //////////////////////////////////////////////////////////////////////////////////
    //		æ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç† - ä¿®å¤ç‰ˆæœ¬
    //////////////////////////////////////////////////////////////////////////////////

    // é¼ æ ‡ç‚¹å‡»äº‹ä»¶å¤„ç†
    function onMouseClick(event) {
      event.preventDefault();
      
      // è®¡ç®—é¼ æ ‡åœ¨æ ‡å‡†åŒ–è®¾å¤‡åæ ‡ä¸­çš„ä½ç½® (-1 åˆ° +1)
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

      debugLog(`ç‚¹å‡»ä½ç½®: x=${mouse.x.toFixed(2)}, y=${mouse.y.toFixed(2)}`);

      // æ›´æ–°å°„çº¿æŠ•å°„å™¨ - ä½¿ç”¨ARç›¸æœºçš„å½“å‰çŸ©é˜µ
      raycaster.setFromCamera(mouse, camera);

      // è®¡ç®—ä¸å¯ç‚¹å‡»ç‰©ä½“çš„äº¤ç‚¹
      var intersects = raycaster.intersectObjects(clickableObjects, true);

      debugLog(`æ£€æµ‹åˆ° ${intersects.length} ä¸ªäº¤ç‚¹`);

      if (intersects.length > 0) {
        var clickedObject = intersects[0].object;
        debugLog(`ç‚¹å‡»åˆ°ç‰©ä½“: ${clickedObject.userData.name || 'æœªçŸ¥ç‰©ä½“'}`);
        
        if (clickedObject.userData.clickable) {
          handleSphereClick(clickedObject);
        }
      } else {
        debugLog("æœªç‚¹å‡»åˆ°ä»»ä½•ç‰©ä½“");
        
        // è°ƒè¯•ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç‚¹å‡»ç‰©ä½“çš„ä½ç½®
        clickableObjects.forEach((obj, index) => {
          var worldPos = new THREE.Vector3();
          obj.getWorldPosition(worldPos);
          console.log(`ç‰©ä½“ ${index} ä¸–ç•Œåæ ‡:`, worldPos);
        });
      }
    }

    // ç®€åŒ–çš„ç‚¹å‡»æ£€æµ‹æ–¹æ³• - ä½¿ç”¨è¾¹ç•Œçƒæ£€æµ‹
    function checkSphereClick(event) {
      event.preventDefault();
      
      // è®¡ç®—é¼ æ ‡ä½ç½®
      var mouseX = (event.clientX / window.innerWidth) * 2 - 1;
      var mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
      
      debugLog(`ç®€åŒ–æ£€æµ‹: x=${mouseX.toFixed(2)}, y=${mouseY.toFixed(2)}`);

      // è·å–çƒä½“çš„ä¸–ç•Œä½ç½®
      var sphereWorldPos = new THREE.Vector3();
      sphere.getWorldPosition(sphereWorldPos);
      
      // å°†ä¸–ç•Œåæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡
      var screenPos = sphereWorldPos.clone();
      screenPos.project(camera);
      
      // è®¡ç®—å±å¹•åæ ‡
      var screenX = (screenPos.x + 1) / 2 * window.innerWidth;
      var screenY = (-screenPos.y + 1) / 2 * window.innerHeight;
      
      debugLog(`çƒä½“å±å¹•ä½ç½®: x=${screenX.toFixed(0)}, y=${screenY.toFixed(0)}`);

      // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨çƒä½“é™„è¿‘ï¼ˆç®€åŒ–ç¢°æ’æ£€æµ‹ï¼‰
      var distance = Math.sqrt(
        Math.pow(event.clientX - screenX, 2) + 
        Math.pow(event.clientY - screenY, 2)
      );
      
      debugLog(`ç‚¹å‡»è·ç¦»: ${distance.toFixed(0)}px`);

      // å¦‚æœè·ç¦»å°äºé˜ˆå€¼ï¼Œè®¤ä¸ºç‚¹å‡»æˆåŠŸ
      if (distance < 50) { // 50åƒç´ é˜ˆå€¼
        handleSphereClick(sphere);
        debugLog("âœ… æˆåŠŸç‚¹å‡»çƒä½“ï¼");
      } else {
        debugLog("âŒ æœªç‚¹å‡»åˆ°çƒä½“");
      }
    }

    // å¤„ç†çƒä½“ç‚¹å‡»
    function handleSphereClick(sphere) {
      console.log("ğŸ¯ çƒä½“è¢«ç‚¹å‡»äº†ï¼");
      
      sphereClicked = !sphereClicked; // åˆ‡æ¢ç‚¹å‡»çŠ¶æ€
      
      // æ˜¾ç¤ºç‚¹å‡»æ•ˆæœ
      showClickEffect();
      
      if (sphereClicked) {
        // ç‚¹å‡»çŠ¶æ€ï¼šæ”¹å˜é¢œè‰²å’Œå‘å…‰æ•ˆæœ
        sphere.material.color.set(0x00ff00); // å˜ä¸ºç»¿è‰²
        sphere.material.emissive.set(0x00ff00);
        sphere.material.emissiveIntensity = 0.5;
        
        // æ·»åŠ è„‰åŠ¨æ•ˆæœ
        sphere.userData.originalScale = sphere.scale.x;
        
        // æ”¹å˜æç¤ºæ–‡å­—
        document.getElementById("clickHint").innerHTML = "ğŸ’š å†æ¬¡ç‚¹å‡»æ¢å¤åŸçŠ¶";
        document.getElementById("clickHint").style.color = "#00ff00";
      } else {
        // æ¢å¤åŸçŠ¶
        sphere.material.color.set(sphere.userData.originalColor);
        sphere.material.emissive.set(sphere.userData.originalColor);
        sphere.material.emissiveIntensity = 0.3;
        sphere.scale.setScalar(sphere.userData.originalScale);
        
        // æ¢å¤æç¤ºæ–‡å­—
        document.getElementById("clickHint").innerHTML = "ğŸ’¡ ç‚¹å‡»ç²‰è‰²çƒä½“æœ‰æƒŠå–œï¼";
        document.getElementById("clickHint").style.color = "#4fc3f7";
      }
    }

    // æ˜¾ç¤ºç‚¹å‡»æ•ˆæœ
    function showClickEffect() {
      var effectElement = document.getElementById("clickEffect");
      effectElement.style.display = "block";
      effectElement.style.opacity = "1";
      effectElement.style.transform = "translate(-50%, -50%) scale(1)";
      
      // åŠ¨ç”»æ•ˆæœ
      var startTime = Date.now();
      var duration = 1000; // 1ç§’
      
      function animateEffect() {
        var elapsed = Date.now() - startTime;
        var progress = elapsed / duration;
        
        if (progress < 1) {
          effectElement.style.transform = `translate(-50%, -50%) scale(${1 + progress * 0.5})`;
          effectElement.style.opacity = (1 - progress).toString();
          requestAnimationFrame(animateEffect);
        } else {
          effectElement.style.display = "none";
        }
      }
      
      animateEffect();
    }

    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬ - ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬
    window.addEventListener("click", checkSphereClick, false);

    // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
    window.addEventListener("touchstart", function(event) {
      if (event.touches.length === 1) {
        checkSphereClick(event.touches[0]);
      }
    }, false);

    //////////////////////////////////////////////////////////////////////////////////
    //		æ¸²æŸ“åœºæ™¯
    //////////////////////////////////////////////////////////////////////////////////

    // æ·»åŠ æ€§èƒ½ç›‘æ§
    var stats = new Stats();
    stats.dom.style.position = "fixed";
    stats.dom.style.top = "60px";
    stats.dom.style.left = "10px";
    stats.dom.style.zIndex = "100";
    document.body.appendChild(stats.dom);

    // æ¸²æŸ“åœºæ™¯å‡½æ•°
    onRenderFcts.push(function () {
      renderer.render(scene, camera);
      stats.update();
    });

    // è¿è¡ŒåŠ¨ç”»å¾ªç¯
    var lastTimeMsec = null;
    requestAnimationFrame(function animate(nowMsec) {
      // ä¿æŒå¾ªç¯
      requestAnimationFrame(animate);

      // è®¡ç®—æ—¶é—´å¢é‡
      lastTimeMsec = lastTimeMsec || nowMsec - 1000 / 60;
      var deltaMsec = Math.min(200, nowMsec - lastTimeMsec);
      lastTimeMsec = nowMsec;

      // è°ƒç”¨æ¯ä¸ªæ¸²æŸ“å‡½æ•°
      onRenderFcts.forEach(function (onRenderFct) {
        onRenderFct(deltaMsec / 1000, nowMsec / 1000);
      });
    });

    // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆæ ‡ç­¾é¡µåˆ‡æ¢ï¼‰
    document.addEventListener("visibilitychange", function () {
      if (!document.hidden) {
        console.log("é¡µé¢é‡æ–°æ¿€æ´»ï¼Œé‡æ–°åˆå§‹åŒ–AR");
        // é¡µé¢é‡æ–°å¯è§æ—¶ï¼Œé‡æ–°åˆå§‹åŒ–ARæº
        arToolkitSource.init(function onReady() {
          arToolkitSource.onResizeElement(
            [
              renderer.domElement,
              arToolkitContext.arController
                ? arToolkitContext.arController.canvas
                : null,
            ].filter(Boolean)
          );
        });
      }
    });

    console.log("ARåº”ç”¨åˆå§‹åŒ–å®Œæˆï¼Œç­‰å¾…æ ‡è®°è¯†åˆ«...");
    debugLog("åº”ç”¨å·²å¯åŠ¨ï¼Œç­‰å¾…æ ‡è®°è¯†åˆ«");
  </script>
</body>